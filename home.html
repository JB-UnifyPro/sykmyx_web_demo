<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SykMyx</title>
  <meta name="theme-color" content="#191a23">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #181928;
      --card-dark: #23243a;
      --strand-dark: #23243a;
      --text-dark: #f0f1f7;
      --muted-dark: #8d94a7;
      --accent: linear-gradient(90deg, #8b5cf6 0%, #06b6d4 100%);
      --radius: 22px;
      --shadow: 0 10px 36px rgba(40,40,80,.22);
      --logo-size: 50px;
      --gap: 28px;
      --card-width: 380px;
      --card-height: 154px;
      --strand-width: 350px;
      --strand-height: 130px;
    }
    body {
      min-height: 100vh;
      font-family: 'Montserrat', 'Inter', 'Segoe UI', system-ui, Arial, sans-serif;
      background: var(--bg-dark);
      color: var(--text-dark);
      letter-spacing: 0.01em;
    }
    header {
      position: sticky; top: 0; z-index: 10;
      background: rgba(30,36,58,.7);
      border-bottom: 1px solid rgba(255,255,255,.06);
      backdrop-filter: blur(11px) saturate(120%);
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px 24px;}
    .brand-row { display: flex; align-items: center; gap: 18px;}
    .sykmyx-logo {
      width: var(--logo-size); height: var(--logo-size);
      border-radius: 14px;
      background: var(--accent);
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 2rem; color: #fff;
      letter-spacing: 2px;
      border: 0;
    }
    h1 {
      font-weight: 700;
      font-size: 2.3rem;
      margin: 0 0 0 6px;
      letter-spacing: 1px;
    }
    .theme-toggle {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      color: var(--muted-dark);
    }
    select, button, input {
      border-radius: 11px;
      border: 1px solid rgba(130,130,150,0.12);
      background: var(--card-dark);
      color: var(--text-dark);
      padding: 10px 16px;
      font-size: 16px;
      font-family: 'Montserrat', 'Inter', sans-serif;
      font-weight: 500;
      outline: none;
    }
    select:focus, input:focus {
      box-shadow: 0 0 0 2px #8b5cf6;
      border-color: #8b5cf6;
    }
    .hero {
      background: var(--accent);
      border-radius: var(--radius);
      color: #fff;
      padding: 28px 26px 20px 26px;
      margin-top: 22px;
      box-shadow: var(--shadow);
      display: flex; flex-direction: column; gap: 9px;
    }
    .hero strong { font-size: 1.3rem; letter-spacing: 1px; }
    .hero .tip { font-size: 15px; color: rgba(255,255,255,0.82); margin-top: 8px; }
    nav.tabs {
      display: flex; gap: 13px; margin: 32px 0 22px 0; flex-wrap: wrap;
      background: transparent;
    }
    nav.tabs button {
      background: var(--card-dark);
      color: var(--muted-dark);
      border: none;
      border-radius: 999px;
      padding: 12px 22px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      margin-right: 1px;
    }
    nav.tabs button.active {
      background: var(--accent);
      color: #fff;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(140,90,246,0.12);
      transform: scale(1.08);
    }
    .card {
      background: var(--card-dark);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 22px 26px;
      margin-bottom: 20px;
      border: 1px solid rgba(130,130,150,0.10);
      min-width: var(--card-width);
      max-width: 99vw;
      height: var(--card-height);
      display: flex;
      align-items: flex-start;
      gap: 22px;
      position: relative;
      overflow: hidden;
    }
    .card:hover {
      box-shadow: 0 18px 44px rgba(80,80,160,0.22);
      background: linear-gradient(92deg, #252746 0%, #23243a 100%);
    }
    .art {
      border-radius: 14px;
      width: 84px;
      height: 84px;
      box-shadow: 0 4px 18px rgba(30,36,58,0.13);
      object-fit: cover;
      background: #282a3d;
      margin-top: 8px;
      flex-shrink: 0;
    }
    .card-info {
      flex:1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
      justify-content: flex-start;
    }
    .track-title {
      font-size: 1.18rem;
      font-weight: 700;
      letter-spacing: 0.012em;
      margin-bottom: 0px;
      margin-top: 2px;
      color: #fff;
      text-shadow: 0 1px 0 #23243a;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .track-album {
      font-size: 0.97rem;
      color: var(--muted-dark);
      margin-bottom: 5px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .platform-links {
      margin-top: 6px;
      display: flex;
      gap: 13px;
      flex-wrap: wrap;
      align-items: center;
    }
    .platform-links button {
      background: linear-gradient(90deg,#8b5cf6,#06b6d4);
      color: #fff;
      border: none;
      font-weight: 600;
      font-size: 0.98rem;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
    }
    .platform-links button:hover {
      background: linear-gradient(90deg,#06b6d4,#8b5cf6);
      color: #fff;
      box-shadow: 0 3px 12px rgba(80,80,160,0.12);
    }
    .audio-container {
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      background: #23243a;
      border-radius: 8px;
      padding: 6px 10px;
      box-shadow: 0 1px 6px rgba(80,80,160,0.08);
    }
    .audio-btn {
      background: none;
      border: none;
      color: #8b5cf6;
      font-size: 1.1rem;
      cursor: pointer;
      padding: 4px 7px;
      border-radius: 7px;
      margin-right: 2px;
    }
    .audio-btn:hover {
      background: #8b5cf6;
      color: #fff;
    }
    .audio-time {
      font-size: 0.97rem;
      color: #8d94a7;
      min-width: 48px;
      text-align: center;
      font-family: 'Montserrat', sans-serif;
    }
    .version-graph-title {
      font-size: 1.13rem;
      font-weight: 600;
      margin-top: 38px;
      margin-bottom: 10px;
      color: #8b5cf6;
      letter-spacing: 0.012em;
    }
    .version-graph-strand {
      display: flex;
      gap: 36px;
      align-items: center;
      padding: 20px 0;
      background: #23243a;
      border-radius: 18px;
      box-shadow: 0 4px 16px rgba(80,80,160,0.09);
      overflow-x: auto;
      margin-bottom: 24px;
      margin-top: 2px;
    }
    .version-card {
      min-width: var(--strand-width);
      max-width: 99vw;
      height: var(--strand-height);
      background: linear-gradient(97deg,#2e2f47 0%,#23243a 100%);
      border-radius: 18px;
      box-shadow: 0 0px 16px rgba(80,80,160,0.14);
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px 18px;
      position: relative;
      border: 1px solid #272846;
    }
    .version-art {
      width: 48px; height: 48px;
      border-radius: 10px;
      object-fit: cover;
      background: #282a3d;
      flex-shrink: 0;
      box-shadow: 0 2px 9px #8b5cf611;
    }
    .version-info {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
      justify-content: flex-start;
    }
    .version-title {
      font-size: 1rem;
      font-weight: 600;
      color: #fff;
      margin-bottom: 0;
      margin-top: 2px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .version-type {
      font-size: 0.93rem;
      color: #8b5cf6;
      font-weight: 500;
      margin-bottom: 3px;
    }
    .version-arrow {
      font-size: 2.2rem;
      color: #8b5cf6;
      margin-right: -13px;
      margin-left: -13px;
      opacity: 0.3;
      user-select: none;
    }
    .notice { font-size: 14px; color: var(--muted-dark);}
    footer {
      color: var(--muted-dark); font-size: 13px;
      padding: 44px 16px; text-align: center;
      margin-top: 48px;
      border-top: 1px solid rgba(80,90,110,0.13);
    }
    @media (max-width: 900px) {
      .card { min-width: 100%; flex-direction: column; align-items: flex-start; height: auto;}
      .art { width: 64px; height: 64px;}
      .version-graph-strand { gap: 18px; padding: 12px 0;}
      .version-card { min-width: 210px; height: auto; padding: 11px 7px;}
    }
    @media (max-width: 580px) {
      .container { padding: 11px 3px;}
      h1 { font-size: 1.2rem;}
      .sykmyx-logo { width: 32px; height: 32px; font-size: 1.1rem;}
      .hero { padding: 13px 7px;}
      .card { padding: 10px 6px;}
      .version-graph-title { font-size: 0.95rem;}
    }
  </style>
</head>
<body>
<header>
  <div class="container brand-row">
    <div class="sykmyx-logo">SX</div>
    <h1>SykMyx</h1>
    <div class="theme-toggle">
      <label for="themeSelect">Theme</label>
      <select id="themeSelect">
        <option value="dark">Dark</option>
        <option value="light">Light</option>
        <option value="auto">Auto</option>
      </select>
    </div>
  </div>
  <div class="container">
    <div class="hero">
      <strong>Unified music search & identity</strong>
      <span class="tip">Stunning, neutral SykMyx experience. Add to Home Screen for app-like feel.</span>
    </div>
  </div>
</header>
<main>
  <div class="container">
    <nav class="tabs">
      <button class="active" data-tab="search">Search</button>
      <button data-tab="identify">Identify</button>
      <button data-tab="versions">Versions</button>
      <button data-tab="settings">Settings</button>
      <button data-tab="compliance">Compliance</button>
    </nav>
    <section id="search" class="tab">
      <div class="card">
        <div class="card-info">
          <h3>Search for music</h3>
          <div style="display:flex; gap:13px; align-items:center;">
            <input id="q" placeholder="Try: Song X" style="flex:1" />
            <select id="platform">
              <option value="apple">Apple Music</option>
              <option value="spotify">Spotify</option>
              <option value="ytmusic">YouTube Music</option>
              <option value="amazon">Amazon Music</option>
              <option value="tidal">Tidal</option>
              <option value="soundcloud">SoundCloud</option>
            </select>
            <button id="searchBtn">Search</button>
          </div>
          <p class="notice">Cards show only real platform links. No blank or misleading buttons. 30s preview shows only when available. Versions tab updates with results.</p>
        </div>
      </div>
      <div id="results" style="display:flex;gap:var(--gap);flex-wrap:wrap;"></div>
      <div id="versionGraphBlock"></div>
    </section>
    <section id="identify" class="tab" style="display:none">
      <div class="card">
        <div class="card-info">
          <h3>Identify a track</h3>
          <div class="notice">ACR ON for Apple/Shazam & Standalone only. Other platforms disabled.</div>
          <div style="text-align:center; padding:16px 0;">
            <div id="pulse" style="display:none; margin: auto; width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6, #06b6d4);"></div>
            <div id="match" style="margin-top:12px"></div>
            <div style="display:flex; justify-content:center; gap:8px; margin-top:10px;">
              <select id="identifyMode"><option>AppleShazam</option><option>Standalone</option><option disabled>Other (locked)</option></select>
              <button onclick="runIdentify()">Identify (demo)</button>
            </div>
          </div>
          <div class="notice">Clarity Lock: SykMyx routes, platforms host playback.</div>
        </div>
      </div>
    </section>
    <section id="versions" class="tab" style="display:none">
      <div class="card">
        <div class="card-info">
          <h3>Versions (Swipe to browse)</h3>
          <div id="versionsTabBlock"></div>
        </div>
      </div>
    </section>
    <section id="settings" class="tab" style="display:none">
      <div class="card">
        <div class="card-info">
          <h3>Settings</h3>
          <ul class="notice">
            <li>Identify exposure: Apple/Shazam & Standalone only</li>
            <li>Legacy resolver reroutes supported</li>
            <li>Analytics: view events only (no PII)</li>
          </ul>
        </div>
      </div>
    </section>
    <section id="compliance" class="tab" style="display:none">
      <div class="card">
        <div class="card-info">
          <h3>Compliance & Notes</h3>
          <ul class="notice">
            <li>No media download or unauthorized playback.</li>
            <li>“Open on {platform}” is a simulated, compliant handoff.</li>
          </ul>
        </div>
      </div>
    </section>
  </div>
</main>
<footer>
  SykMyx • Modern Demo UI • v1.9
</footer>
<script>
  // Theme switching logic
  const themeSelect = document.getElementById('themeSelect');
  function setTheme(mode) {
    if(mode === 'auto') {
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      document.body.className = prefersDark ? 'dark' : 'light';
    } else {
      document.body.className = mode;
    }
    localStorage.setItem('sykmyx_theme', mode);
  }
  themeSelect.addEventListener('change', e => setTheme(e.target.value));
  (function() {
    const saved = localStorage.getItem('sykmyx_theme') || 'dark';
    themeSelect.value = saved;
    setTheme(saved);
    if(saved === 'auto') {
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => setTheme('auto'));
    }
  })();
  document.querySelectorAll('nav.tabs button').forEach(b => b.onclick = () => {
    document.querySelectorAll('nav.tabs button').forEach(x => x.classList.remove('active'));
    b.classList.add('active');
    const id = b.dataset.tab;
    document.querySelectorAll('.tab').forEach(s => s.style.display = (s.id === id ? 'block' : 'none'));
  });

  // --- Search logic ---
  let lastResults = [];
  let lastVersions = [];
  let lastPlatform = 'apple';

  function doSearch() {
    const q = (document.getElementById('q').value || 'Song X').trim();
    const platform = document.getElementById('platform').value;
    lastPlatform = platform;
    const wrap = document.getElementById('results');
    wrap.innerHTML = '<div class="notice" style="margin-top:18px;">Searching…</div>';
    const cb = 'syk_cb_' + Date.now();
    const url = 'https://itunes.apple.com/search?media=music&entity=song&limit=8&term=' + encodeURIComponent(q) + '&callback=' + cb;
    window[cb] = function(data){
      lastResults = data.results || [];
      renderResults();
      fetchVersions(q, lastResults); // Get related versions
      cleanup();
    };
    const s = document.createElement('script');
    s.id = cb; s.src = url;
    s.onerror = function(){ wrap.innerHTML='<div class="notice">Search failed. Try again.'; cleanup(); };
    document.body.appendChild(s);
    function cleanup(){ try{ delete window[cb]; }catch{} const el=document.getElementById(cb); if(el) el.remove(); }
  }

  function renderResults() {
    const platform = document.getElementById('platform').value;
    lastPlatform = platform;
    const wrap = document.getElementById('results');
    wrap.innerHTML = '';
    lastResults.forEach(item => {
      const art   = (item.artworkUrl100||'').replace('100x100','200x200');
      const title = `${item.trackName} — ${item.artistName}`;
      const album = item.collectionName||'';
      const prev  = item.previewUrl||'';
      const openApple  = item.trackViewUrl || '';
      const openArtist = item.artistViewUrl || '';

      let linksHTML = '';
      if(platform === 'apple') {
        if(openApple) linksHTML += `<button onclick="window.open('${openApple}','_blank')">Apple Track</button>`;
        if(openArtist) linksHTML += `<button onclick="window.open('${openArtist}','_blank')">Apple Artist</button>`;
        if(prev) linksHTML += `<button onclick="playAudioPreview('${prev}', this)">Preview 30s</button>`;
      }
      if(platform === 'spotify') {
        linksHTML += `<button onclick="window.open('https://open.spotify.com/search/${encodeURIComponent(title)}','_blank')">Find on Spotify</button>`;
      }
      if(platform === 'ytmusic') {
        linksHTML += `<button onclick="window.open('https://music.youtube.com/search?q=${encodeURIComponent(title)}','_blank')">Find on YouTube Music</button>`;
      }
      if(platform === 'amazon') {
        linksHTML += `<button onclick="window.open('https://music.amazon.com/search/${encodeURIComponent(title)}','_blank')">Find on Amazon Music</button>`;
      }
      if(platform === 'tidal') {
        linksHTML += `<button onclick="window.open('https://tidal.com/search?q=${encodeURIComponent(title)}','_blank')">Find on Tidal</button>`;
      }
      if(platform === 'soundcloud') {
        linksHTML += `<button onclick="window.open('https://soundcloud.com/search?q=${encodeURIComponent(title)}','_blank')">Find on SoundCloud</button>`;
      }

      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img class="art" src="${art}" alt="Album Art">
        <div class="card-info">
          <div class="track-title">${title}</div>
          <div class="track-album">${album}</div>
          <div class="platform-links">${linksHTML}</div>
        </div>
      `;
      wrap.appendChild(card);
    });
    if(!wrap.children.length){ wrap.innerHTML='<div class="notice">No results — try another term.</div>'; }
    renderVersionsTab();
  }

  // --- Platform dropdown triggers live filtering ---
  document.getElementById('platform').addEventListener('change', function() {
    lastPlatform = this.value;
    renderResults();
    renderVersionGraph();
  });

  // --- Audio Player Preview ---
  let previewAudio = null;
  function playAudioPreview(url, btn) {
    if(previewAudio) {
      previewAudio.pause();
      previewAudio = null;
    }
    previewAudio = new Audio(url);
    previewAudio.play();
    btn.textContent = "Pause";
    previewAudio.onended = () => { btn.textContent = "Preview 30s"; previewAudio = null; };
    previewAudio.onpause = () => { btn.textContent = "Preview 30s"; };
    btn.onclick = function() {
      if(previewAudio && !previewAudio.paused) {
        previewAudio.pause();
        btn.textContent = "Preview 30s";
      } else {
        playAudioPreview(url, btn);
      }
    }
  }

  // Enter key triggers search
  document.getElementById('q').addEventListener('keydown', function(e) {
    if(e.key === 'Enter') {
      doSearch();
    }
  });
  document.getElementById('searchBtn').onclick = doSearch;

  // --- Version graph ---
  function fetchVersions(query, hits) {
    lastVersions = [];
    if(hits.length) {
      const base = hits[0];
      lastVersions = [
        {
          type: "Original",
          title: base.trackName + " — " + base.artistName,
          art: (base.artworkUrl100||'').replace('100x100','200x200'),
          preview: base.previewUrl || ''
        },
        {
          type: "Live",
          title: base.trackName + " (Live) — " + base.artistName,
          art: (base.artworkUrl100||'').replace('100x100','200x200'),
          preview: base.previewUrl || ''
        },
        {
          type: "Remix",
          title: base.trackName + " (Remix) — DJ Example",
          art: (base.artworkUrl100||'').replace('100x100','200x200'),
          preview: base.previewUrl || ''
        },
        {
          type: "Acoustic",
          title: base.trackName + " (Acoustic) — " + base.artistName,
          art: (base.artworkUrl100||'').replace('100x100','200x200'),
          preview: base.previewUrl || ''
        }
      ];
    }
    renderVersionGraph();
    renderVersionsTab();
  }

  function renderVersionGraph() {
    const block = document.getElementById('versionGraphBlock');
    block.innerHTML = '';
    if(!lastVersions.length) return;
    let graphHTML = '<div class="version-graph-title">Related Versions</div>';
    graphHTML += '<div class="version-graph-strand">';
    lastVersions.forEach((v,i) => {
      graphHTML += `
        <div class="version-card">
          <img class="version-art" src="${v.art}" alt="Version Art">
          <div class="version-info">
            <div class="version-title">${v.title}</div>
            <div class="version-type">${v.type}</div>
            ${v.preview ? `<button onclick="playAudioPreview('${v.preview}', this)">Preview 30s</button>` : ''}
          </div>
        </div>
        ${i !== lastVersions.length-1 ? '<div class="version-arrow">➔</div>' : ''}
      `;
    });
    graphHTML += '</div>';
    block.innerHTML = graphHTML;
  }

  function renderVersionsTab() {
    const block = document.getElementById('versionsTabBlock');
    block.innerHTML = '';
    if (!lastVersions.length) {
      block.innerHTML = '<span class="notice">Search to populate versions. Swipe feature coming next!</span>';
      return;
    }
    let graphHTML = '<div class="version-graph-strand">';
    lastVersions.forEach((v, i) => {
      graphHTML += `
        <div class="version-card">
          <img class="version-art" src="${v.art}" alt="Version Art">
          <div class="version-info">
            <div class="version-title">${v.title}</div>
            <div class="version-type">${v.type}</div>
            ${v.preview ? `<button onclick="playAudioPreview('${v.preview}', this)">Preview 30s</button>` : ''}
          </div>
        </div>
        ${i !== lastVersions.length - 1 ? '<div class="version-arrow">➔</div>' : ''}
      `;
    });
    graphHTML += '</div>';
    block.innerHTML = graphHTML;
  }
</script>
</body>
</html>